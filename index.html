<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>HEMA School - Enquiry Form</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Your existing CSS and styles stay here -->
    <link rel="stylesheet" href="your-existing-css.css">

    <!-- PDF + Excel libraries (Excel harmless here, shared across pages) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
        integrity="sha512-YcsIPGdh3trnV5vW0vL4fHRNS+2sZpB3L5kLyUe7xjUTy4E7mS4k+vH9t0v7wT1Yx2BhF3aN4kO8CO1w2T5p7A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/package/dist/xlsx.full.min.js"></script>

    <style>
        /* Your existing styles should remain above or below */

        @media print {
            body {
                margin: 0;
                padding: 0;
            }
            .no-print,
            .no-print * {
                display: none !important;
            }
            #printArea {
                page-break-inside: avoid;
            }
        }

        #printArea {
            max-width: 900px;
            margin: 0 auto;
            background: #ffffff;
        }
    </style>
</head>
<body>

<!-- Print / PDF controls (hidden in print) -->
<div class="print-controls no-print" style="margin:10px 0;">
    <button type="button" onclick="window.print()">Print</button>
    <button type="button" onclick="downloadPdf()">Save as PDF</button>
</div>

<!-- Start of printable content -->
<div id="printArea">

    <!-- ===== Your existing header section (unchanged) ===== -->
    <header>
        <!-- Example: replace with your real header HTML -->
        <div style="text-align:center; padding:10px; background:#004b8d; color:#fff;">
            <h2>HEMA Higher Secondary School</h2>
            <p>Affiliated to: CENTRAL BOARD OF SECONDARY EDUCATION</p>
            <p>School Code: 50383 | Affiliation No.: 1030417</p>
            <p>Govindpura, Bhopal, Madhya Pradesh, India - 462023</p>
            <p>ðŸ“§ support@hemaschool.education | ðŸ“ž 0755-2457270</p>
        </div>
    </header>

    <!-- ===== Your existing enquiry form START (fields unchanged) ===== -->
    <main style="padding: 15px;">
        <h3 style="text-align:center;">Enquiry Form</h3>

        <!-- IMPORTANT: keep your original form tag and fields inside this form -->
        <form id="enquiryForm">
            <!-- 
                PASTE ALL YOUR ORIGINAL ENQUIRY FIELDS HERE.
                Examples below are placeholders â€“ replace with your actual fields:

                Do not rename any name="" or id="" you already use.
            -->

            <!-- Example fields; REPLACE with your real ones -->
            <div>
                <label>Enquiry Date:
                    <input type="date" name="enquiryDate" id="enquiryDate">
                </label>
            </div>

            <div>
                <label>Student Name:
                    <input type="text" name="studentName" id="studentName">
                </label>
            </div>

            <div>
                <label>Class Applied For:
                    <input type="text" name="class" id="class">
                </label>
            </div>

            <div>
                <label>Gender:
                    <select name="gender" id="gender">
                        <option value="">Select</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </label>
            </div>

            <div>
                <label>Father Mobile:
                    <input type="text" name="fatherMobile" id="fatherMobile">
                </label>
            </div>

            <div>
                <label>District:
                    <input type="text" name="district" id="district">
                </label>
            </div>

            <div>
                <label>Pincode:
                    <input type="text" name="pincode" id="pincode">
                </label>
            </div>

            <!-- Your existing document checklist, automations, calculations, etc. remain here -->
            <!-- ... ALL existing enquiry form content ... -->

            <!-- Your existing submit/save buttons go here (unchanged) -->

            <!-- New button to continue to Registration (added) -->
            <div style="margin-top:15px;">
                <button type="button" id="btnProceedToRegistration">Proceed to Registration</button>
            </div>
        </form>
    </main>
    <!-- ===== Your existing enquiry form END ===== -->

</div>
<!-- End #printArea -->

<!-- ===== Shared Print-to-PDF JS ===== -->
<script>
function downloadPdf() {
    var element = document.getElementById('printArea');
    if (!element) return;
    const opt = {
        margin:       5,
        filename:     'hema-enquiry-form.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
        pagebreak:    { mode: ['avoid-all', 'css', 'legacy'] }
    };
    html2pdf().set(opt).from(element).save();
}
</script>

<!-- ===== Data transfer + storage JS (Enquiry -> Registration & central records) ===== -->
<script>
// Collect all enquiry form data into an object
function getEnquiryFormData() {
    const form = document.getElementById('enquiryForm');
    const data = {};
    if (!form) return data;

    const elements = form.querySelectorAll('input, select, textarea');
    elements.forEach(el => {
        if (!el.name && !el.id) return;
        const key = el.name || el.id;
        if (el.type === 'checkbox') {
            data[key] = el.checked;
        } else if (el.type === 'radio') {
            if (el.checked) data[key] = el.value;
        } else {
            data[key] = el.value;
        }
    });
    return data;
}

// Prefill Enquiry form from localStorage (Edit flow)
function fillEnquiryFormFromStorage() {
    const stored = localStorage.getItem('hema_enquiry_current');
    if (!stored) return;
    let data;
    try { data = JSON.parse(stored); } catch (e) { return; }

    const form = document.getElementById('enquiryForm');
    if (!form) return;

    const elements = form.querySelectorAll('input, select, textarea');
    elements.forEach(el => {
        const key = el.name || el.id;
        if (!key || !(key in data)) return;

        if (el.type === 'checkbox') {
            el.checked = !!data[key];
        } else if (el.type === 'radio') {
            if (el.value === data[key]) el.checked = true;
        } else {
            el.value = data[key];
        }
    });
}

// Save enquiry record to central array
function saveEnquiryToCentralRecords(enquiryData) {
    const recordsRaw = localStorage.getItem('hema_records');
    let records = [];
    if (recordsRaw) {
        try { records = JSON.parse(recordsRaw); } catch (e) { records = []; }
    }

    let currentId = localStorage.getItem('hema_current_id');
    if (!currentId) {
        currentId = 'ENQ-' + Date.now();
        localStorage.setItem('hema_current_id', currentId);
    }

    const idx = records.findIndex(r => r.id === currentId);
    const now = new Date().toISOString();

    const payload = {
        id: currentId,
        createdAt: idx === -1 ? now : (records[idx].createdAt || now),
        updatedAt: now,
        enquiry: enquiryData,
        registration: idx === -1 ? {} : (records[idx].registration || {}),
        admission: idx === -1 ? {} : (records[idx].admission || {})
    };

    if (idx === -1) {
        records.push(payload);
    } else {
        records[idx] = payload;
    }

    localStorage.setItem('hema_records', JSON.stringify(records));
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function () {
    // Prefill if editing an existing record
    fillEnquiryFormFromStorage();

    // Proceed to registration
    const proceedBtn = document.getElementById('btnProceedToRegistration');
    if (proceedBtn) {
        proceedBtn.addEventListener('click', function () {
            const enquiryData = getEnquiryFormData();
            // Store enquiry data for use by registration/admission
            localStorage.setItem('hema_enquiry_current', JSON.stringify(enquiryData));
            // Also update central records
            saveEnquiryToCentralRecords(enquiryData);
            // Go to Registration page
            window.location.href = 'registration.html';
        });
    }
});
</script>

</body>
</html>
