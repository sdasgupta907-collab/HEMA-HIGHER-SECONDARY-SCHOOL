<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEMA School - Enquiry Form 2026-2027</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 28px; margin-bottom: 5px; }
        .header p { font-size: 14px; opacity: 0.9; }
        .nav-bar {
            background: #f5f5f5;
            padding: 15px 30px;
            display: flex;
            gap: 20px;
            border-bottom: 2px solid #ddd;
        }
        .nav-bar a {
            text-decoration: none;
            color: #1e3c72;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 5px;
            transition: all 0.3s;
        }
        .nav-bar a:hover { background: #667eea; color: white; }
        .nav-bar a.active { background: #1e3c72; color: white; }
        .form-container { padding: 30px; }
        fieldset {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f9f9f9;
        }
        legend {
            font-size: 16px;
            font-weight: bold;
            color: #1e3c72;
            padding: 0 10px;
            margin-left: -10px;
        }
        .row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }
        .row.full { grid-template-columns: 1fr; }
        .row.half { grid-template-columns: 1fr 1fr; }
        .form-group { display: flex; flex-direction: column; }
        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 13px;
        }
        input, select, textarea {
            padding: 10px;
            border: 1.5px solid #ddd;
            border-radius: 5px;
            font-size: 13px;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }
        input.uppercase { text-transform: uppercase; }
        .form-group.required label::after { content: ' *'; color: red; }
        .gender-group, .referred-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }
        .gender-group label, .referred-group label {
            display: flex;
            align-items: center;
            margin-bottom: 0;
            font-weight: normal;
            margin-top: 0;
        }
        .gender-group input, .referred-group input {
            margin-right: 8px;
            width: 18px;
            height: 18px;
        }
        .source-group {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        .source-group label {
            display: flex;
            align-items: center;
            margin-bottom: 0;
            font-weight: normal;
        }
        .source-group input { margin-right: 8px; width: 18px; height: 18px; }
        .fee-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 13px;
        }
        th {
            background: #f5f5f5;
            font-weight: 600;
            color: #1e3c72;
            border-bottom: 2px solid #ddd;
        }
        tr:hover { background: #f9f9f9; }
        .total-row { background: #e8f0fe; font-weight: bold; }
        .grand-total-row { background: #1e3c72; color: white; font-weight: bold; }
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }
        button {
            padding: 12px 30px;
            font-size: 14px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-submit { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102,126,234,0.4); }
        .btn-reset { background: #f44336; color: white; }
        .btn-reset:hover { background: #d32f2f; }
        .btn-pdf { background: #4CAF50; color: white; }
        .btn-pdf:hover { background: #388E3C; }
        .btn-register { background: #FF9800; color: white; }
        .btn-register:hover { background: #F57C00; }
        .age-display {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
            padding: 8px;
            background: #f0f0f0;
            border-radius: 4px;
        }
        .success-msg {
            display: none;
            background: #4CAF50;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        .fee-data {
            background: #fff3e0;
            padding: 12px;
            border-radius: 5px;
            margin-top: 8px;
            font-size: 12px;
            color: #555;
        }
        @media print {
            body { background: white; }
            .buttons, .nav-bar { display: none; }
            .container { box-shadow: none; }
        }
        .sibling-section {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .documents-section {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .doc-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 15px;
        }
        .doc-list h4 {
            color: #1e3c72;
            font-size: 14px;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }
        .doc-list ul { list-style: none; padding: 0; }
        .doc-list li {
            padding: 8px 0;
            font-size: 12px;
            color: #333;
            border-bottom: 1px solid #e0e0e0;
        }
        .doc-list li:last-child { border-bottom: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>HEMA HIGHER SECONDARY SCHOOL</h1>
            <p>Affiliated to CBSE New Delhi | D-Sector, Security Line, Govindpura, BHEL, Bhopal - 462023</p>
            <p>Student Enquiry Form - Academic Session 2026-2027</p>
        </div>

        <div class="nav-bar">
            <a href="index.html" class="active">üìù Enquiry</a>
            <a href="registration.html">üìã Registration</a>
            <a href="admission.html">‚úÖ Admission</a>
            <a href="data.html">üìä View Records</a>
        </div>

        <div class="form-container">
            <div class="success-msg" id="successMsg">‚úì Enquiry saved successfully!</div>

            <form id="enquiryForm">
                <fieldset>
                    <legend>üìã BASIC INFORMATION</legend>
                    <div class="row half">
                        <div class="form-group">
                            <label for="sno">S.NO. (MANUAL)</label>
                            <input type="text" id="sno" name="sno" placeholder="e.g., 2026001" class="uppercase">
                        </div>
                        <div class="form-group">
                            <label for="date">DATE</label>
                            <input type="date" id="date" name="date">
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>üë§ STUDENT DETAILS</legend>
                    <div class="row">
                        <div class="form-group required">
                            <label for="studentFirst">FIRST NAME</label>
                            <input type="text" id="studentFirst" name="studentFirst" class="uppercase" required>
                        </div>
                        <div class="form-group">
                            <label for="studentMiddle">MIDDLE NAME</label>
                            <input type="text" id="studentMiddle" name="studentMiddle" class="uppercase">
                        </div>
                        <div class="form-group">
                            <label for="studentSurname">SURNAME</label>
                            <input type="text" id="studentSurname" name="studentSurname" class="uppercase">
                        </div>
                    </div>

                    <div class="row half">
                        <div class="form-group">
                            <label>GENDER</label>
                            <div class="gender-group">
                                <label><input type="radio" name="gender" value="MALE"> MALE</label>
                                <label><input type="radio" name="gender" value="FEMALE"> FEMALE</label>
                            </div>
                        </div>
                        <div class="form-group required">
                            <label for="classApplied">CLASS APPLYING FOR</label>
                            <select id="classApplied" name="classApplied" required>
                                <option value="">-- SELECT CLASS --</option>
                                <option value="NURSERY">NURSERY</option>
                                <option value="KG I">KG I</option>
                                <option value="KG II">KG II</option>
                                <option value="I">CLASS I</option>
                                <option value="II">CLASS II</option>
                                <option value="III">CLASS III</option>
                                <option value="IV">CLASS IV</option>
                                <option value="V">CLASS V</option>
                                <option value="VI">CLASS VI</option>
                                <option value="VII">CLASS VII</option>
                                <option value="VIII">CLASS VIII</option>
                                <option value="IX">CLASS IX</option>
                                <option value="X">CLASS X</option>
                                <option value="XI">CLASS XI</option>
                                <option value="XII">CLASS XII</option>
                            </select>
                        </div>
                    </div>

                    <div class="row half">
                        <div class="form-group required">
                            <label for="dob">DATE OF BIRTH</label>
                            <input type="date" id="dob" name="dob" required>
                        </div>
                        <div class="form-group">
                            <label>AGE (AUTO-CALCULATED)</label>
                            <div id="ageDisplay" class="age-display">-- Select DOB --</div>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ SIBLING DETAILS (IF ANY)</legend>
                    <div class="sibling-section">
                        <h3 style="margin-bottom: 15px; color: #1e3c72;">SIBLING 1</h3>
                        <div class="row">
                            <div class="form-group">
                                <label for="sib1Name">NAME</label>
                                <input type="text" id="sib1Name" name="sib1Name" class="uppercase">
                            </div>
                            <div class="form-group">
                                <label for="sib1School">SCHOOL</label>
                                <input type="text" id="sib1School" name="sib1School" class="uppercase">
                            </div>
                            <div class="form-group">
                                <label for="sib1Class">CLASS</label>
                                <select id="sib1Class" name="sib1Class">
                                    <option value="">-- SELECT --</option>
                                    <option value="NURSERY">NURSERY</option>
                                    <option value="KG I">KG I</option>
                                    <option value="KG II">KG II</option>
                                    <option value="I">I</option>
                                    <option value="II">II</option>
                                    <option value="III">III</option>
                                    <option value="IV">IV</option>
                                    <option value="V">V</option>
                                    <option value="VI">VI</option>
                                    <option value="VII">VII</option>
                                    <option value="VIII">VIII</option>
                                    <option value="IX">IX</option>
                                    <option value="X">X</option>
                                    <option value="XI">XI</option>
                                    <option value="XII">XII</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label for="sib1Section">SECTION</label>
                                <select id="sib1Section" name="sib1Section">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                </select>
                            </div>
                            <div class="form-group"></div>
                            <div class="form-group"></div>
                        </div>
                    </div>

                    <div class="sibling-section">
                        <h3 style="margin-bottom: 15px; color: #1e3c72;">SIBLING 2</h3>
                        <div class="row">
                            <div class="form-group">
                                <label for="sib2Name">NAME</label>
                                <input type="text" id="sib2Name" name="sib2Name" class="uppercase">
                            </div>
                            <div class="form-group">
                                <label for="sib2School">SCHOOL</label>
                                <input type="text" id="sib2School" name="sib2School" class="uppercase">
                            </div>
                            <div class="form-group">
                                <label for="sib2Class">CLASS</label>
                                <select id="sib2Class" name="sib2Class">
                                    <option value="">-- SELECT --</option>
                                    <option value="NURSERY">NURSERY</option>
                                    <option value="KG I">KG I</option>
                                    <option value="KG II">KG II</option>
                                    <option value="I">I</option>
                                    <option value="II">II</option>
                                    <option value="III">III</option>
                                    <option value="IV">IV</option>
                                    <option value="V">V</option>
                                    <option value="VI">VI</option>
                                    <option value="VII">VII</option>
                                    <option value="VIII">VIII</option>
                                    <option value="IX">IX</option>
                                    <option value="X">X</option>
                                    <option value="XI">XI</option>
                                    <option value="XII">XII</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label for="sib2Section">SECTION</label>
                                <select id="sib2Section" name="sib2Section">
                                    <option value="">--</option>
                                    <option value="A">A</option>
                                    <option value="B">B</option>
                                    <option value="C">C</option>
                                    <option value="D">D</option>
                                </select>
                            </div>
                            <div class="form-group"></div>
                            <div class="form-group"></div>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>üë®‚Äçüë© PARENT DETAILS</legend>
                    <div class="row">
                        <div class="form-group">
                            <label for="fatherFirst">FATHER'S FIRST NAME</label>
                            <input type="text" id="fatherFirst" name="fatherFirst" class="uppercase">
                        </div>
                        <div class="form-group">
                            <label for="fatherMiddle">FATHER'S MIDDLE NAME</label>
                            <input type="text" id="fatherMiddle" name="fatherMiddle" class="uppercase">
                        </div>
                        <div class="form-group">
                            <label for="fatherSurname">FATHER'S SURNAME</label>
                            <input type="text" id="fatherSurname" name="fatherSurname" class="uppercase">
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="motherFirst">MOTHER'S FIRST NAME</label>
                            <input type="text" id="motherFirst" name="motherFirst" class="uppercase">
                        </div>
                        <div class="form-group">
                            <label for="motherMiddle">MOTHER'S MIDDLE NAME</label>
                            <input type="text" id="motherMiddle" name="motherMiddle" class="uppercase">
                        </div>
                        <div class="form-group">
                            <label for="motherSurname">MOTHER'S SURNAME</label>
                            <input type="text" id="motherSurname" name="motherSurname" class="uppercase">
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group required">
                            <label for="fatherMobile">FATHER'S MOBILE</label>
                            <input type="tel" id="fatherMobile" name="fatherMobile" required>
                        </div>
                        <div class="form-group">
                            <label for="motherMobile">MOTHER'S MOBILE</label>
                            <input type="tel" id="motherMobile" name="motherMobile">
                        </div>
                        <div class="form-group">
                            <label for="landline">LANDLINE</label>
                            <input type="tel" id="landline" name="landline">
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>üìç CONTACT DETAILS</legend>
                    <div class="row full">
                        <div class="form-group required">
                            <label for="address">ADDRESS</label>
                            <textarea id="address" name="address" rows="2" class="uppercase" required></textarea>
                        </div>
                    </div>

                    <div class="row half">
                        <div class="form-group">
                            <label for="area">AREA/LOCALITY</label>
                            <input type="text" id="area" name="area" class="uppercase">
                        </div>
                        <div class="form-group required">
                            <label for="state">STATE</label>
                            <select id="state" name="state" required>
                                <option value="">-- SELECT STATE --</option>
                                <option value="ANDAMAN AND NICOBAR ISLANDS">ANDAMAN AND NICOBAR ISLANDS</option>
                                <option value="ANDHRA PRADESH">ANDHRA PRADESH</option>
                                <option value="ARUNACHAL PRADESH">ARUNACHAL PRADESH</option>
                                <option value="ASSAM">ASSAM</option>
                                <option value="BIHAR">BIHAR</option>
                                <option value="CHANDIGARH">CHANDIGARH</option>
                                <option value="CHHATTISGARH">CHHATTISGARH</option>
                                <option value="DADRA AND NAGAR HAVELI AND DAMAN AND DIU">DADRA AND NAGAR HAVELI AND DAMAN AND DIU</option>
                                <option value="DELHI">DELHI</option>
                                <option value="GOA">GOA</option>
                                <option value="GUJARAT">GUJARAT</option>
                                <option value="HARYANA">HARYANA</option>
                                <option value="HIMACHAL PRADESH">HIMACHAL PRADESH</option>
                                <option value="JAMMU AND KASHMIR">JAMMU AND KASHMIR</option>
                                <option value="JHARKHAND">JHARKHAND</option>
                                <option value="KARNATAKA">KARNATAKA</option>
                                <option value="KERALA">KERALA</option>
                                <option value="LADAKH">LADAKH</option>
                                <option value="LAKSHADWEEP">LAKSHADWEEP</option>
                                <option value="MADHYA PRADESH">MADHYA PRADESH</option>
                                <option value="MAHARASHTRA">MAHARASHTRA</option>
                                <option value="MANIPUR">MANIPUR</option>
                                <option value="MEGHALAYA">MEGHALAYA</option>
                                <option value="MIZORAM">MIZORAM</option>
                                <option value="NAGALAND">NAGALAND</option>
                                <option value="ODISHA">ODISHA</option>
                                <option value="PUDUCHERRY">PUDUCHERRY</option>
                                <option value="PUNJAB">PUNJAB</option>
                                <option value="RAJASTHAN">RAJASTHAN</option>
                                <option value="SIKKIM">SIKKIM</option>
                                <option value="TAMIL NADU">TAMIL NADU</option>
                                <option value="TELANGANA">TELANGANA</option>
                                <option value="TRIPURA">TRIPURA</option>
                                <option value="UTTAR PRADESH">UTTAR PRADESH</option>
                                <option value="UTTARAKHAND">UTTARAKHAND</option>
                                <option value="WEST BENGAL">WEST BENGAL</option>
                            </select>
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>üì¢ SOURCE OF INFORMATION</legend>
                    <div class="form-group">
                        <label>HOW DID YOU KNOW ABOUT US?</label>
                        <div class="source-group">
                            <label><input type="checkbox" name="source" value="NEWSPAPER"> NEWSPAPER</label>
                            <label><input type="checkbox" name="source" value="SCHOOL WEBSITE"> SCHOOL WEBSITE</label>
                            <label><input type="checkbox" name="source" value="FACEBOOK"> FACEBOOK</label>
                            <label><input type="checkbox" name="source" value="INSTAGRAM"> INSTAGRAM</label>
                            <label><input type="checkbox" name="source" value="BILLBOARD"> BILLBOARD</label>
                            <label><input type="checkbox" name="source" value="WORD OF MOUTH"> WORD OF MOUTH</label>
                        </div>
                    </div>

                    <div class="row full">
                        <div class="form-group">
                            <label>IF REFERRED</label>
                            <div class="referred-group">
                                <label><input type="radio" name="referredType" value="MEMBER"> MEMBER</label>
                                <label><input type="radio" name="referredType" value="PARENT"> PARENT</label>
                                <label><input type="radio" name="referredType" value="STAFF"> STAFF</label>
                                <label><input type="radio" name="referredType" value="OTHER"> OTHER</label>
                            </div>
                        </div>
                    </div>

                    <div class="row full">
                        <div class="form-group">
                            <label for="referredName">REFERRED PERSON'S NAME</label>
                            <input type="text" id="referredName" name="referredName" class="uppercase">
                        </div>
                    </div>
                </fieldset>

                <fieldset>
                    <legend>üí∞ FEE STRUCTURE</legend>
                    <div class="row full">
                        <div class="form-group required">
                            <label for="classForFee">SELECT CLASS TO VIEW FEES</label>
                            <select id="classForFee" name="classForFee" required>
                                <option value="">-- SELECT CLASS --</option>
                                <option value="NURSERY, KG I & KG II">NURSERY, KG I & KG II</option>
                                <option value="I">CLASS I</option>
                                <option value="II">CLASS II</option>
                                <option value="III">CLASS III</option>
                                <option value="IV-V">CLASS IV-V</option>
                                <option value="VI-VIII">CLASS VI-VIII</option>
                                <option value="IX-X">CLASS IX-X</option>
                                <option value="XI-XII">CLASS XI-XII</option>
                            </select>
                        </div>
                    </div>

                    <div class="fee-section">
                        <table>
                            <thead>
                                <tr>
                                    <th>S.NO.</th>
                                    <th>PARTICULAR</th>
                                    <th>AMOUNT (‚Çπ)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1.</td>
                                    <td>ADMISSION FEE</td>
                                    <td><input type="number" id="feeAdmission" readonly></td>
                                </tr>
                                <tr>
                                    <td>2.</td>
                                    <td>DEVELOPMENT FUND</td>
                                    <td><input type="number" id="feeDevelopment" readonly></td>
                                </tr>
                                <tr>
                                    <td>3.</td>
                                    <td>CAUTION MONEY DEPOSIT</td>
                                    <td><input type="number" id="feeCaution" readonly></td>
                                </tr>
                                <tr class="total-row">
                                    <td colspan="2"><strong>TOTAL ONE-TIME</strong></td>
                                    <td><input type="number" id="totalOneTime" readonly style="font-weight:bold;background:#e8f0fe;"></td>
                                </tr>
                                <tr>
                                    <td>4.</td>
                                    <td>TUITION FEE (9 MONTHS)</td>
                                    <td><input type="number" id="feeTuition" readonly></td>
                                </tr>
                                <tr>
                                    <td>5.</td>
                                    <td>ANNUAL CHARGES</td>
                                    <td><input type="number" id="feeAnnual" readonly></td>
                                </tr>
                                <tr>
                                    <td>6.</td>
                                    <td>TRANSPORT FEE (OPTIONAL)</td>
                                    <td><input type="number" id="feeTransport" placeholder="Enter if needed"></td>
                                </tr>
                                <tr class="total-row">
                                    <td colspan="2"><strong>TOTAL RECURRING</strong></td>
                                    <td><input type="number" id="totalRecurring" readonly style="font-weight:bold;background:#e8f0fe;"></td>
                                </tr>
                                <tr class="grand-total-row">
                                    <td colspan="2"><strong>GRAND TOTAL</strong></td>
                                    <td><input type="number" id="grandTotal" readonly style="font-weight:bold;background:#1e3c72;color:white;"></td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="fee-data" id="feeInfo" style="display:none;"></div>
                    </div>
                </fieldset>

                <div class="buttons">
                    <button type="button" class="btn-pdf" onclick="window.print()">üñ®Ô∏è PRINT</button>
                    <button type="submit" class="btn-submit">‚úì SAVE ENQUIRY</button>
                    <button type="button" class="btn-register" onclick="proceedToRegistration()">üìã PROCEED TO REGISTRATION</button>
                    <button type="reset" class="btn-reset">‚úï CLEAR</button>
                </div>
            </form>
        </div>
    </div>

    <script>

        // ===== EDIT MODE FUNCTIONALITY =====
        let editMode = false;
        let editIndex = -1;

        // Check if we're in edit mode (URL parameter)
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const editId = urlParams.get('edit');

            if (editId !== null) {
                editMode = true;
                editIndex = parseInt(editId);
                loadEnquiryForEdit(editIndex);
            }
        });

        // Load enquiry data for editing
        function loadEnquiryForEdit(index) {
            const records = JSON.parse(localStorage.getItem('enquiryRecords') || '[]');
            const record = records[index];

            if (!record) {
                alert('Enquiry record not found!');
                window.location.href = 'data.html';
                return;
            }

            // Pre-fill all form fields
            document.getElementById('date').value = record.date || '';
            document.getElementById('sno').value = record.sno || '';
            document.getElementById('studentFirst').value = record.studentFirst || '';
            document.getElementById('studentMiddle').value = record.studentMiddle || '';
            document.getElementById('studentSurname').value = record.studentSurname || '';
            document.getElementById('classApplied').value = record.classApplied || '';

            // Gender
            if (record.gender === 'MALE') {
                document.querySelector('input[name="gender"][value="MALE"]').checked = true;
            } else if (record.gender === 'FEMALE') {
                document.querySelector('input[name="gender"][value="FEMALE"]').checked = true;
            }

            document.getElementById('dob').value = record.dob || '';

            // Trigger age calculation if DOB exists
            if (record.dob) {
                document.getElementById('dob').dispatchEvent(new Event('change'));
            }

            // Sibling info
            document.getElementById('sib1Name').value = record.sib1Name || '';
            document.getElementById('sib1School').value = record.sib1School || '';
            document.getElementById('sib1Class').value = record.sib1Class || '';
            document.getElementById('sib1Section').value = record.sib1Section || '';
            document.getElementById('sib2Name').value = record.sib2Name || '';
            document.getElementById('sib2School').value = record.sib2School || '';
            document.getElementById('sib2Class').value = record.sib2Class || '';
            document.getElementById('sib2Section').value = record.sib2Section || '';

            // Parent details
            document.getElementById('fatherFirst').value = record.fatherFirst || '';
            document.getElementById('fatherMiddle').value = record.fatherMiddle || '';
            document.getElementById('fatherSurname').value = record.fatherSurname || '';
            document.getElementById('motherFirst').value = record.motherFirst || '';
            document.getElementById('motherMiddle').value = record.motherMiddle || '';
            document.getElementById('motherSurname').value = record.motherSurname || '';
            document.getElementById('fatherMobile').value = record.fatherMobile || '';
            document.getElementById('motherMobile').value = record.motherMobile || '';
            document.getElementById('landline').value = record.landline || '';

            // Address
            document.getElementById('address').value = record.address || '';
            document.getElementById('area').value = record.area || '';
            document.getElementById('state').value = record.state || '';

            // District and Pincode if they exist
            if (document.getElementById('district')) {
                document.getElementById('district').value = record.district || '';
            }
            if (document.getElementById('pincode')) {
                document.getElementById('pincode').value = record.pincode || '';
            }

            // Source checkboxes
            if (record.source && Array.isArray(record.source)) {
                record.source.forEach(src => {
                    const checkbox = document.querySelector(`input[name="source"][value="${src}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }

            // Referred type
            if (record.referredType) {
                const radio = document.querySelector(`input[name="referredType"][value="${record.referredType}"]`);
                if (radio) radio.checked = true;
            }
            document.getElementById('referredName').value = record.referredName || '';

            // Trigger fee calculation if class exists
            if (record.classApplied) {
                const feeSelect = document.getElementById('classForFee');
                if (feeSelect) {
                    // Map class to fee structure options
                    let feeClass = record.classApplied;
                    if (['NURSERY', 'KG I', 'KG II'].includes(feeClass)) {
                        feeClass = 'NURSERY, KG I & KG II';
                    } else if (['IV', 'V'].includes(feeClass)) {
                        feeClass = 'IV-V';
                    } else if (['VI', 'VII', 'VIII'].includes(feeClass)) {
                        feeClass = 'VI-VIII';
                    } else if (['IX', 'X'].includes(feeClass)) {
                        feeClass = 'IX-X';
                    } else if (['XI', 'XII'].includes(feeClass)) {
                        feeClass = 'XI-XII';
                    }
                    feeSelect.value = feeClass;
                    feeSelect.dispatchEvent(new Event('change'));
                }
            }

            // Change submit button text
            const submitBtn = document.querySelector('.btn-submit');
            if (submitBtn) {
                submitBtn.textContent = 'UPDATE ENQUIRY';
            }

            // Add cancel button
            const buttonsDiv = document.querySelector('.buttons');
            if (buttonsDiv && !document.getElementById('cancelEditBtn')) {
                const cancelBtn = document.createElement('button');
                cancelBtn.type = 'button';
                cancelBtn.className = 'btn-reset';
                cancelBtn.id = 'cancelEditBtn';
                cancelBtn.textContent = 'CANCEL EDIT';
                cancelBtn.onclick = function() {
                    if (confirm('Cancel editing? Any changes will be lost.')) {
                        window.location.href = 'data.html';
                    }
                };
                buttonsDiv.insertBefore(cancelBtn, submitBtn);
            }

            // Show edit mode indicator
            const formContainer = document.querySelector('.form-container');
            if (formContainer && !document.getElementById('editModeIndicator')) {
                const indicator = document.createElement('div');
                indicator.id = 'editModeIndicator';
                indicator.style.cssText = 'background: #ff9800; color: white; padding: 15px; text-align: center; font-weight: bold; margin-bottom: 20px; border-radius: 5px;';
                indicator.innerHTML = '‚úèÔ∏è EDIT MODE - Updating Enquiry Record';
                formContainer.insertBefore(indicator, formContainer.firstChild);
            }
        }


        const feeData = {
            "NURSERY, KG I & KG II": { admission: 27000, development: 5000, caution: 3000, tuition: 14645.2, annual: 6955 },
            "I":  { admission: 30000, development: 5000, caution: 3000, tuition: 21296,   annual: 9754 },
            "II": { admission: 30000, development: 5000, caution: 3000, tuition: 22634,   annual: 13906 },
            "III":{ admission: 30000, development: 5000, caution: 3000, tuition: 23953.6, annual: 15304 },
            "IV-V":{ admission: 30000, development: 5000, caution: 3000, tuition: 26620,  annual: 17390 },
            "VI-VIII":{ admission: 41000, development: 5000, caution: 3000, tuition: 29280.2, annual: 17385 },
            "IX-X":{ admission: 55000, development: 5000, caution: 3000, tuition: 29286.4, annual: 23634 },
            "XI-XII":{ admission: 62000, development: 5000, caution: 3000, tuition: 29280, annual: 25044 }
        };

        document.querySelectorAll('.uppercase').forEach(input => {
            input.addEventListener('input', function() {
                this.value = this.value.toUpperCase();
            });
        });

        document.getElementById('date').valueAsDate = new Date();

        document.getElementById('dob').addEventListener('change', function() {
            const dob = new Date(this.value);
            const today = new Date();
            let years = today.getFullYear() - dob.getFullYear();
            let months = today.getMonth() - dob.getMonth();
            let days = today.getDate() - dob.getDate();
            if (days < 0) {
                months--;
                days += new Date(today.getFullYear(), today.getMonth(), 0).getDate();
            }
            if (months < 0) {
                years--;
                months += 12;
            }
            document.getElementById('ageDisplay').innerHTML = '<strong>' + years + ' YEARS ' + months + ' MONTHS ' + days + ' DAYS</strong>';
        });

        document.getElementById('classForFee').addEventListener('change', function() {
            const sel = this.value;
            const fees = feeData[sel];
            if (!fees) {
                ['feeAdmission','feeDevelopment','feeCaution','feeTuition','feeAnnual','totalOneTime','totalRecurring','grandTotal','feeTransport']
                 .forEach(id => document.getElementById(id).value = '');
                document.getElementById('feeInfo').style.display = 'none';
                return;
            }
            document.getElementById('feeAdmission').value = fees.admission;
            document.getElementById('feeDevelopment').value = fees.development;
            document.getElementById('feeCaution').value = fees.caution;
            document.getElementById('feeTuition').value = fees.tuition;
            document.getElementById('feeAnnual').value = fees.annual;

            const oneTime = fees.admission + fees.development + fees.caution;
            const recurring = fees.tuition + fees.annual;

            document.getElementById('totalOneTime').value = oneTime;
            document.getElementById('totalRecurring').value = recurring;
            document.getElementById('grandTotal').value = oneTime + recurring;

            document.getElementById('feeInfo').innerHTML = '<strong>Fee Breakdown:</strong><br>One-Time: ‚Çπ' + oneTime + '<br>Recurring: ‚Çπ' + recurring;
            document.getElementById('feeInfo').style.display = 'block';
        });

        document.getElementById('feeTransport').addEventListener('input', function() {
            const oneTime = parseFloat(document.getElementById('totalOneTime').value) || 0;
            const recurring = parseFloat(document.getElementById('totalRecurring').value) || 0;
            const transport = parseFloat(this.value) || 0;
            document.getElementById('grandTotal').value = oneTime + recurring + transport;
        });

        document.getElementById('enquiryForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const formData = new FormData(this);
        const data = {};

        formData.forEach((value, key) => {
            if (data[key]) {
                if (Array.isArray(data[key])) {
                    data[key].push(value);
                } else {
                    data[key] = [data[key], value];
                }
            } else {
                data[key] = value;
            }
        });

        data.timestamp = new Date().toISOString();
        data.age = document.getElementById('ageDisplay').innerText;

        let records = JSON.parse(localStorage.getItem('enquiryRecords') || '[]');

        // Check if we're in edit mode
        if (editMode && editIndex >= 0) {
            // UPDATE existing record
            records[editIndex] = data;
            localStorage.setItem('enquiryRecords', JSON.stringify(records));
            alert('‚úÖ Enquiry updated successfully!');
            window.location.href = 'data.html';
        } else {
            // ADD new record
            records.push(data);
            localStorage.setItem('enquiryRecords', JSON.stringify(records));

            // Store as current enquiry for registration
            localStorage.setItem('currentEnquiry', JSON.stringify(data));

            document.getElementById('successMsg').style.display = 'block';

            setTimeout(() => {
                if (confirm("Enquiry saved! OK to proceed to Registration, Cancel to add another enquiry")) {
                    window.location.href = 'registration.html';
                } else {
                    this.reset();
                    document.getElementById('successMsg').style.display = 'none';
                    document.getElementById('date').valueAsDate = new Date();
                }
            }, 500);
        }
    });

        function proceedToRegistration() {
            const form = document.getElementById('enquiryForm');
            if (!form.checkValidity()) {
                alert('Please fill all required fields before proceeding to registration!');
                form.reportValidity();
                return;
            }
            form.dispatchEvent(new Event('submit'));
        }
    </script>
</body>
</html>
